# CUHKstudy - é¦™æ¸¯ä¸­æ–‡å¤§å­¦è¯¾ç¨‹èµ„æ–™åˆ†äº«å¹³å° v1.1

[![ç‰ˆæœ¬](https://img.shields.io/badge/ç‰ˆæœ¬-v1.1.0-blue)](./VERSION)
[![ç³»ç»ŸçŠ¶æ€](https://img.shields.io/badge/ç³»ç»ŸçŠ¶æ€-è‰¯å¥½_84.6%25-green)](./system_health_report.json)
[![Hugo](https://img.shields.io/badge/Hugo-0.148.2-ff4088)](https://gohugo.io/)
[![Python](https://img.shields.io/badge/Python-3.x-3776ab)](https://python.org/)

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„é¦™æ¸¯ä¸­æ–‡å¤§å­¦è¯¾ç¨‹èµ„æ–™åˆ†äº«å¹³å°ï¼ŒåŸºäº Hugo æ„å»ºï¼Œé›†æˆäº†ï¼š
- âœ… **é˜…è¯»é‡ç»Ÿè®¡ç³»ç»Ÿ** - è‡ªå»ºè½»é‡çº§é¡µé¢è®¿é—®è·Ÿè¸ª
- âœ… **æ™ºèƒ½CDNåŠ é€Ÿ** - Cloudflare R2 ä¼˜åŒ–å¤§æ–‡ä»¶åŠ è½½
- âœ… **åœ¨çº¿Markdownç¼–è¾‘å™¨** - æ”¯æŒè¯­æ³•é«˜äº®å’Œæ–‡ä»¶åˆ†ç±»
- âœ… **ä¸­æ–‡ä¼˜åŒ–** - å®Œæ•´çš„ä¸­æ–‡å­—ä½“å’Œç¼–ç æ”¯æŒ
- âœ… **ç°ä»£åŒ–è®¾è®¡** - å“åº”å¼å¸ƒå±€å’ŒTokyo Nightä¸»é¢˜
- âœ… **ç³»ç»Ÿç›‘æ§** - è‡ªåŠ¨å¥åº·æ£€æŸ¥å’Œæ€§èƒ½ç›‘æ§
- âœ… Cloudflare R2 CDN åŠ é€Ÿ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸ“Š v1.1 æ–°åŠŸèƒ½

#### é˜…è¯»é‡ç»Ÿè®¡ç³»ç»Ÿ
- **è‡ªåŠ¨è·Ÿè¸ª**: é¡µé¢è®¿é—®å’Œå¡ç‰‡ç‚¹å‡»è‡ªåŠ¨è®°å½•
- **å®æ—¶æ˜¾ç¤º**: åœ¨é¡µé¢å¡ç‰‡ä¸Šæ˜¾ç¤ºğŸ‘ï¸é˜…è¯»é‡æ ‡è®°
- **éšç§ä¿æŠ¤**: ä»…å­˜å‚¨hashåŒ–è®¿å®¢ä¿¡æ¯ï¼Œä¸è®°å½•IPåœ°å€
- **APIæ¥å£**: æ”¯æŒç¼–ç¨‹è®¿é—®ç»Ÿè®¡æ•°æ®

```bash
# æŸ¥çœ‹çƒ­é—¨é¡µé¢
curl http://localhost/api/popular

# æŸ¥çœ‹ç‰¹å®šé¡µé¢ç»Ÿè®¡
curl "http://localhost/api/stats?url=/ugfn/"
```

#### åœ¨çº¿Markdownç¼–è¾‘å™¨ (ç«¯å£8888)
- **è®¿é—®åœ°å€**: http://localhost:8888/editor
- **æ–‡ä»¶åˆ†ç±»**: æ™ºèƒ½åˆ†ç±»è¯¾ç¨‹å†…å®¹ã€åŸºç¡€æ–‡ä»¶ã€æ ‡ç­¾åˆ†ç±»
- **è¯­æ³•é«˜äº®**: CodeMirroræ”¯æŒMarkdownè¯­æ³•é«˜äº®
- **Hugoæ”¯æŒ**: è‡ªåŠ¨è¯†åˆ«å’Œæ¸²æŸ“Hugo Front Matter
- **å¿«æ·é”®**: Ctrl+Sä¿å­˜, Ctrl+Råˆ·æ–°

#### ç³»ç»Ÿå¥åº·ç›‘æ§
```bash
# è¿è¡Œç³»ç»Ÿå¥åº·æ£€æŸ¥
cd /root/cuhkstudy
python3 scripts/system_health_check.py
```

### åˆ›å»ºæ–°æ’­å®¢æ–‡ç« 
```bash
# åˆ›å»ºç®€ä½“ä¸­æ–‡æ–‡ç« 
./new-post.sh "ç¬¬äºŒæœŸæ’­å®¢ï¼šæŠ€æœ¯åˆ†äº«"

# åˆ›å»ºç¹ä½“ä¸­æ–‡æ–‡ç«   
./new-post.sh "ç¬¬äºŒæœŸæ’­å®¢ï¼šæŠ€æœ¯åˆ†äº«" zh-tw

# åŒæ—¶åˆ›å»ºä¸­ç¹ä¸¤ä¸ªç‰ˆæœ¬
./new-post.sh "ç¬¬äºŒæœŸæ’­å®¢ï¼šæŠ€æœ¯åˆ†äº«" both
```

### éƒ¨ç½²ç½‘ç«™
```bash
# éƒ¨ç½²åŒ…å«è‰ç¨¿çš„ç‰ˆæœ¬ï¼ˆç”¨äºé¢„è§ˆï¼‰
./deploy.sh --draft

# éƒ¨ç½²æ­£å¼ç‰ˆæœ¬
./deploy.sh
```

## ğŸŒ CDN æ¶æ„

æœ¬ç½‘ç«™é‡‡ç”¨**æ™ºèƒ½æ··åˆCDNæ¶æ„**ï¼Œç»“åˆnginxæœ¬åœ°æœåŠ¡å’ŒCloudflare R2å…¨çƒCDNï¼š

```
ç”¨æˆ·è¯·æ±‚ â†’ nginx â†’ [æœ¬åœ°æ–‡ä»¶å­˜åœ¨?] â†’ æ˜¯ â†’ ç›´æ¥è¿”å› (å°æ–‡ä»¶)
                â†“ å¦
                â†’ Cloudflare R2 CDN â†’ è¿”å›æ–‡ä»¶ (å¤§æ–‡ä»¶)
```

### ğŸ¯ æ–‡ä»¶åˆ†å±‚ç­–ç•¥

| æ–‡ä»¶ç±»å‹ | å­˜å‚¨ä½ç½® | è¯´æ˜ |
|---------|---------|------|
| HTML/CSS/JS | nginxæœ¬åœ° | å°æ–‡ä»¶ï¼Œå¿«é€Ÿå“åº” |
| å¤§PDF/å›¾ç‰‡ | Cloudflare R2 | >100KBæ–‡ä»¶ï¼Œå…¨çƒCDNåŠ é€Ÿ |
| å­—ä½“æ–‡ä»¶ | Cloudflare R2 | woff2å­—ä½“ï¼Œç¼“å­˜30å¤© |

### ğŸ“Š ä¼˜åŒ–æˆæœ

- ğŸ—‚ï¸ **æ–‡ä»¶å»é‡**: ä»269ä¸ªæ–‡ä»¶ä¼˜åŒ–åˆ°48ä¸ªæ ¸å¿ƒæ–‡ä»¶  
- ğŸ“¦ **å­˜å‚¨ä¼˜åŒ–**: 103.49MB CDNå­˜å‚¨ï¼ŒèŠ‚çœå¸¦å®½æˆæœ¬
- âš¡ **åŠ è½½æå‡**: å¤§æ–‡ä»¶å…¨çƒCDNåˆ†å‘ï¼Œæ˜¾è‘—æå‡è®¿é—®é€Ÿåº¦
- ğŸ›¡ï¸ **æ™ºèƒ½å›é€€**: nginxè‡ªåŠ¨åœ¨æœ¬åœ°å’ŒCDNé—´é€‰æ‹©æœ€ä¼˜è·¯å¾„

## ğŸ“ ç›®å½•ç»“æ„

```
/root/cuhkstudy/
â”œâ”€â”€ content/
â”‚   â”œâ”€â”€ zh-cn/          # ç®€ä½“ä¸­æ–‡å†…å®¹
â”‚   â””â”€â”€ zh-tw/          # ç¹ä½“ä¸­æ–‡å†…å®¹
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ pdfs/           # PDF æ–‡ä»¶ (CDNåŒæ­¥)
â”‚   â”œâ”€â”€ img/            # å›¾ç‰‡æ–‡ä»¶ (CDNåŒæ­¥)
â”‚   â”œâ”€â”€ fonts/          # å­—ä½“æ–‡ä»¶ (CDNåŒæ­¥)
â”‚   â””â”€â”€ pdfjs/          # PDF.js é˜…è¯»å™¨
â”œâ”€â”€ assets/             # é™æ€èµ„æº (CDNåŒæ­¥)
â”œâ”€â”€ public/             # Hugoç”Ÿæˆæ–‡ä»¶
â”œâ”€â”€ scripts/            # è‡ªåŠ¨åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ upload_to_r2.py        # R2æ‰¹é‡ä¸Šä¼ 
â”‚   â”œâ”€â”€ hugo_r2_sync.py        # Hugoæ„å»ºååŒæ­¥
â”‚   â””â”€â”€ r2_cleanup_optimize.py # CDNä¼˜åŒ–æ¸…ç†
â”œâ”€â”€ nginx-r2-optimized.conf    # nginx CDNé…ç½®
â”œâ”€â”€ .env.example               # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ hugo.toml                  # ç½‘ç«™é…ç½®
â””â”€â”€ README.md                  # æœ¬æ–‡æ¡£
```

## ğŸ”§ å¸¸ç”¨æ“ä½œ

### 1. ä¸Šä¼ æ–‡ä»¶

**éŸ³é¢‘æ–‡ä»¶ï¼š**
```bash
# å°†éŸ³é¢‘æ–‡ä»¶ä¸Šä¼ åˆ°
/home/mypodcast/static/audio/æ–‡ä»¶å.mp3
```

**PDFæ–‡ä»¶ï¼š**
```bash
# å°†PDFæ–‡ä»¶ä¸Šä¼ åˆ°
/home/mypodcast/static/pdfs/æ–‡ä»¶å.pdf
```

### 2. ç¼–è¾‘æ–‡ç« 

```bash
# ç¼–è¾‘ç®€ä½“ä¸­æ–‡æ–‡ç« 
vim content/zh-cn/posts/æ–‡ç« å.md

# ç¼–è¾‘ç¹ä½“ä¸­æ–‡æ–‡ç« 
vim content/zh-tw/posts/æ–‡ç« å.md
```

### 3. ç½‘ç«™é…ç½®

ä¸»è¦é…ç½®æ–‡ä»¶ï¼š`hugo.toml`

**ä¿®æ”¹åŸŸåï¼š**
```toml
baseURL = 'https://æ‚¨çš„åŸŸå/'
```

**ä¿®æ”¹ç½‘ç«™æ ‡é¢˜ï¼š**
```toml
title = 'æ‚¨çš„æ’­å®¢ç«™åç§°'
```

### 4. CDN ç®¡ç†

**åŒæ­¥æ–‡ä»¶åˆ°CDNï¼š**
```bash
# Hugoæ„å»ºåè‡ªåŠ¨åŒæ­¥é™æ€èµ„æºåˆ°R2
python3 scripts/hugo_r2_sync.py --build

# åªåŒæ­¥ç°æœ‰æ–‡ä»¶ï¼ˆä¸é‡æ–°æ„å»ºï¼‰
python3 scripts/hugo_r2_sync.py
```

**æ¸…ç†å’Œä¼˜åŒ–CDNï¼š**
```bash
# æ¸…ç†å†—ä½™æ–‡ä»¶ï¼Œä¼˜åŒ–å­˜å‚¨
python3 scripts/r2_cleanup_optimize.py
```

**æ£€æŸ¥CDNçŠ¶æ€ï¼š**
```bash
# æŸ¥çœ‹nginx CDNçŠ¶æ€
curl http://localhost/api/r2-status

# æµ‹è¯•æ–‡ä»¶CDNå›é€€
curl -I http://localhost/static/pdfs/UGFNä¸­æ–‡ç‰ˆver2.1.pdf
```

### 5. SSL è¯ä¹¦é…ç½®

```bash
# å®‰è£…SSLè¯ä¹¦ï¼ˆéœ€è¦å…ˆé…ç½®åŸŸåDNSï¼‰
certbot --nginx -d æ‚¨çš„åŸŸå
```

## ğŸ¨ è‡ªå®šä¹‰

### ä¿®æ”¹ä¸»é¢˜é¢œè‰²

ä¸»å“ç‰Œè‰²å·²é…ç½®ä¸º `#0EB185`ï¼Œå¦‚éœ€ä¿®æ”¹å¯ç¼–è¾‘ï¼š
- CSS æ–‡ä»¶: `assets/css/custom.css`
- ä¸»é¢˜é…ç½®: `hugo.toml` ä¸­çš„ `params` éƒ¨åˆ†

### æ·»åŠ èœå•é¡¹

åœ¨ `hugo.toml` ä¸­ä¿®æ”¹ `[menu]` éƒ¨åˆ†ï¼š

```toml
[[menu.main]]
    identifier = "new-page"
    name = "æ–°é¡µé¢"
    url = "/new-page/"
    weight = 50
```

## ğŸ“Š ç½‘ç«™ç›‘æ§

### æŸ¥çœ‹è®¿é—®æ—¥å¿—
```bash
tail -f /var/log/nginx/mypodcast_access.log
```

### æŸ¥çœ‹é”™è¯¯æ—¥å¿—
```bash
tail -f /var/log/nginx/mypodcast_error.log
```

### æ£€æŸ¥ç½‘ç«™çŠ¶æ€
```bash
systemctl status nginx
```

## ğŸ” æ•…éšœæ’é™¤

### Hugo æ„å»ºå¤±è´¥
```bash
# æ£€æŸ¥è¯­æ³•é”™è¯¯
hugo --verbose

# æ¸…ç†ç¼“å­˜
rm -rf public/
hugo
```

### Nginx é…ç½®é—®é¢˜
```bash
# æµ‹è¯•é…ç½®
nginx -t

# é‡æ–°åŠ è½½é…ç½®
systemctl reload nginx
```

### æƒé™é—®é¢˜
```bash
# é‡è®¾æ–‡ä»¶æƒé™
chown -R www-data:www-data /var/www/mypodcast
```

## ğŸŒ è®¿é—®åœ°å€

- **ç®€ä½“ä¸­æ–‡**: http://æ‚¨çš„åŸŸå/zh-cn/
- **ç¹ä½“ä¸­æ–‡**: http://æ‚¨çš„åŸŸå/zh-tw/
- **è‡ªåŠ¨é‡å®šå‘**: http://æ‚¨çš„åŸŸå/ (æ ¹æ®æµè§ˆå™¨è¯­è¨€)

## ğŸ›¡ï¸ å®‰å…¨å»ºè®®

1. å®šæœŸæ›´æ–°ç³»ç»Ÿå’Œè½¯ä»¶åŒ…
2. é…ç½® SSL è¯ä¹¦å¯ç”¨ HTTPS
3. å®šæœŸå¤‡ä»½å†…å®¹æ–‡ä»¶
4. ç›‘æ§è®¿é—®æ—¥å¿—

## ğŸ“š æ›´å¤šèµ„æº

- [Hugo å®˜æ–¹æ–‡æ¡£](https://gohugo.io/documentation/)
- [PaperMod ä¸»é¢˜æ–‡æ¡£](https://github.com/adityatelange/hugo-PaperMod)
- [PDF.js æ–‡æ¡£](https://mozilla.github.io/pdf.js/)
- [Nginx é…ç½®æŒ‡å—](https://nginx.org/en/docs/)

---

**æŠ€æœ¯æ”¯æŒ**: å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ç›¸å…³æ—¥å¿—æ–‡ä»¶æˆ–é‡æ–°è¿è¡Œéƒ¨ç½²è„šæœ¬ã€‚