{{/* 覆盖主题 thumbAndBackground：统一使用站点默认背景（R2 CDN），忽略本地 feature/thumbnail */}}
{{ $disableImageOptimization := .Page.Site.Params.disableImageOptimization | default false }}

{{/* 背景图 */}}
{{ $bg := "" }}
{{ $defaultBgUrl := .Site.Params.defaultBackgroundImage }}
{{ if $defaultBgUrl }}
  {{ if or (strings.HasPrefix $defaultBgUrl "http:") (strings.HasPrefix $defaultBgUrl "https:") }}
    {{ $bg = resources.GetRemote $defaultBgUrl }}
  {{ else }}
    {{ $bg = resources.Get $defaultBgUrl }}
  {{ end }}
{{ end }}

{{ $isParentList := eq (.Scratch.Get "scope") "list" }}
{{ $shouldBlur := $.Params.layoutBackgroundBlur | default (or (and ($.Site.Params.article.layoutBackgroundBlur | default true) (not $isParentList)) (and ($.Site.Params.list.layoutBackgroundBlur | default true) ($isParentList))) }}

{{- with $bg -}}
  <div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom" style="background-image:url({{ .RelPermalink }});"></div>
  <div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div>
  <div class="absolute inset-0 {{ if $isParentList }}opacity-80{{ else }}opacity-75{{ end }} bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div>
{{- end -}}

{{/* 前景缩略图仍按主题逻辑显示 */}}
{{- $thumb := .Resources.GetMatch "*thumbnail*" -}}
{{- if not $thumb }}{{ $thumb = .Resources.GetMatch "*feature*" }}{{ end -}}
{{ if and $thumb (not $disableImageOptimization) }}
  {{ $thumb = $thumb.Fill (print "1200x600 q85 Center") }}
{{ end }}
{{ with $thumb }}
  <div class="w-full thumbnail_card nozoom" style="background-image:url({{ .RelPermalink }})"></div>
{{ end }}

{{ if $shouldBlur | default false }}
  <div id="background-blur" class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div>
  {{ $backgroundBlur := resources.Get "js/background-blur.js" }}
  {{ $backgroundBlur = $backgroundBlur | resources.Minify | resources.Fingerprint ($.Site.Params.fingerprintAlgorithm | default "sha512") }}
  <script type="text/javascript" src="{{ $backgroundBlur.RelPermalink }}" integrity="{{ $backgroundBlur.Data.Integrity }}" data-target-id="background-blur"></script>
{{ end }}

